<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QuickBite - Checkout</title>
    <link rel="stylesheet" href="style.css">
    <!-- Font Awesome for icons (CDN) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        /* Specific styles for the Checkout page */
        .checkout-hero {
            background: linear-gradient(rgba(0,0,0,0.6), rgba(0,0,0,0.6)), url('https://images.unsplash.com/photo-1540189549336-e619d4284e13?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1770&q=80') no-repeat center center/cover;
            color: #fff;
            text-align: center;
            padding: 80px 0;
            margin-bottom: 40px;
        }

        .checkout-hero h1 {
            font-size: 3rem;
            margin-bottom: 15px;
            color: #fff;
        }

        .checkout-hero p {
            font-size: 1.2rem;
            color: #eee;
        }

        .checkout-container {
            display: grid;
            grid-template-columns: 2fr 1.2fr; /* Form on left, order summary on right */
            gap: 40px;
            padding: 60px 0;
            align-items: flex-start;
        }

        .checkout-form-sections {
            background: #fff;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
        }

        .checkout-section {
            margin-bottom: 40px;
            padding-bottom: 30px;
            border-bottom: 1px solid var(--light-grey);
        }

        .checkout-section:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }

        .checkout-section h2 {
            font-size: 2rem;
            margin-top: 0;
            margin-bottom: 25px;
            color: var(--secondary-color);
            text-align: left;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: var(--secondary-color);
        }

        .form-group input[type="text"],
        .form-group input[type="email"],
        .form-group input[type="tel"],
        .form-group input[type="password"], /* For card number */
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 1rem;
            outline: none;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            border-color: var(--primary-color);
        }

        textarea {
            min-height: 80px;
            resize: vertical;
        }

        .inline-fields {
            display: flex;
            gap: 20px;
        }

        .inline-fields > div {
            flex: 1;
        }

        .saved-address-card, .saved-card-option {
            background: var(--light-grey);
            border: 1px solid #eee;
            border-radius: 8px;
            padding: 15px 20px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            cursor: pointer;
            transition: border-color 0.2s ease, background 0.2s ease;
        }

        .saved-address-card:hover, .saved-card-option:hover {
            border-color: var(--primary-color);
            background: rgba(var(--primary-color-rgb), 0.05); /* Light highlight */
        }

        .saved-address-card input[type="radio"], .saved-card-option input[type="radio"] {
            margin-right: 15px;
            transform: scale(1.2);
        }
        .saved-address-card.selected, .saved-card-option.selected {
            border-color: var(--primary-color);
            background-color: rgba(255, 87, 34, 0.1); /* Lighter orange */
        }

        .payment-methods-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .payment-method-option {
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        .payment-method-option:hover {
            border-color: var(--primary-color);
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        .payment-method-option.selected {
            border-color: var(--primary-color);
            background-color: rgba(255, 87, 34, 0.1);
        }
        .payment-method-option i {
            font-size: 2.5rem;
            color: var(--secondary-color);
            margin-bottom: 10px;
        }
        .payment-method-option span {
            font-weight: bold;
            color: var(--secondary-color);
        }

        /* Card details specific section */
        #card-details-form {
            background: var(--light-grey);
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
            display: none; /* Hidden by default */
        }

        .order-summary-sidebar {
            background: #fff;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            position: sticky;
            top: 100px;
        }

        .order-summary-sidebar h3 {
            font-size: 1.8rem;
            margin-top: 0;
            margin-bottom: 25px;
            color: var(--secondary-color);
        }

        .summary-item {
            display: flex;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px dashed var(--light-grey);
            align-items: center;
        }

        .summary-item:last-of-type {
            border-bottom: none;
            padding-bottom: 0;
            margin-bottom: 0;
        }

        .summary-item-image {
            width: 60px;
            height: 60px;
            object-fit: cover;
            border-radius: 5px;
            margin-right: 15px;
            flex-shrink: 0;
        }

        .summary-item-details {
            flex-grow: 1;
        }

        .summary-item-details h4 {
            font-size: 1.1rem;
            margin-bottom: 3px;
            color: var(--secondary-color);
        }

        .summary-item-details p {
            font-size: 0.9rem;
            color: var(--text-color);
        }

        .summary-item-price {
            font-weight: bold;
            color: var(--secondary-color);
            flex-shrink: 0;
        }

        /* Reusing summary-row, summary-total styles from cart.html */
        .summary-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px dashed var(--light-grey);
        }

        .summary-row:last-of-type {
            border-bottom: none;
            margin-bottom: 25px;
            padding-bottom: 0;
        }

        .summary-row span:first-child {
            color: var(--text-color);
        }

        .summary-row span:last-child {
            font-weight: bold;
            color: var(--secondary-color);
        }

        .summary-total {
            display: flex;
            justify-content: space-between;
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--primary-color);
            margin-top: 20px;
            margin-bottom: 30px;
        }

        .place-order-btn {
            width: 100%;
            padding: 15px;
            font-size: 1.2rem;
            font-weight: bold;
            border-radius: 5px;
        }

        /* Responsive adjustments */
        @media (max-width: 992px) {
            .checkout-container {
                grid-template-columns: 1fr; /* Stack columns */
                padding: 40px 20px;
            }
            .order-summary-sidebar {
                position: static; /* Remove sticky on smaller screens */
            }
        }

        @media (max-width: 600px) {
            .inline-fields {
                flex-direction: column;
                gap: 0;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="container header-content">
            <div class="logo">QuickBite</div>
            <nav>
                <ul>
                    <li><a href="index.html">Home</a></li>
                    <li><a href="restaurants.html">Restaurants</a></li>
                    <li><a href="how-it-works.html">How it Works</a></li>
                    <li><a href="contact.html">Contact</a></li>
                </ul>
            </nav>
            <div class="user-actions">
                <a href="login.html">Sign In / Register</a>
                <a href="cart.html" class="cart-icon"><i class="fas fa-shopping-cart"></i> <span class="cart-count">0</span></a>
            </div>
        </div>
    </header>

    <main>
        <section class="checkout-hero">
            <div class="container">
                <h1>Checkout</h1>
                <p>Almost there! Just a few more steps to enjoy your meal.</p>
            </div>
        </section>

        <section class="checkout-container container">
            <div class="checkout-form-sections">
                <form id="checkout-form">
                    <div class="checkout-section">
                        <h2>Delivery Address</h2>
                        <!-- Example Saved Address (if logged in) -->
                        <div class="saved-address-card selected" data-address-id="home">
                            <input type="radio" name="delivery-address" value="home" checked>
                            <div>
                                <strong>Home</strong><br>
                                <span>123, Main Street, Near City Center, Mumbai - 400001</span><br>
                                <span>+91 9876543210</span>
                            </div>
                        </div>
                        <div class="saved-address-card" data-address-id="work">
                            <input type="radio" name="delivery-address" value="work">
                            <div>
                                <strong>Work</strong><br>
                                <span>Office No. 501, Business Park, Cyber Hub, Gurugram - 122002</span><br>
                                <span>+91 9988776655</span>
                            </div>
                        </div>

                        <h3>Or Add a New Address</h3>
                        <div class="form-group">
                            <label for="address-line1">Address Line 1</label>
                            <input type="text" id="address-line1" name="address-line1" placeholder="Flat No./House No., Building Name" required>
                        </div>
                        <div class="form-group">
                            <label for="address-line2">Address Line 2 (Optional)</label>
                            <input type="text" id="address-line2" name="address-line2" placeholder="Street Name, Landmark">
                        </div>
                        <div class="inline-fields">
                            <div class="form-group">
                                <label for="city">City</label>
                                <input type="text" id="city" name="city" placeholder="e.g., Mumbai" required>
                            </div>
                            <div class="form-group">
                                <label for="pincode">Pincode</label>
                                <input type="text" id="pincode" name="pincode" placeholder="e.g., 400001" pattern="\d{6}" title="Please enter a 6-digit pincode" required>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="phone">Contact Phone Number</label>
                            <input type="tel" id="phone" name="phone" placeholder="e.g., +91 9876543210" pattern="^\+91\s?\d{10}$|^[6-9]\d{9}$" title="Please enter a valid Indian phone number" required>
                        </div>
                        <div class="form-group">
                            <label for="delivery-instructions">Delivery Instructions (Optional)</label>
                            <textarea id="delivery-instructions" name="delivery-instructions" placeholder="e.g., Leave at reception, don't ring bell"></textarea>
                        </div>
                    </div>

                    <div class="checkout-section">
                        <h2>Payment Method</h2>
                        <div class="payment-methods-grid">
                            <div class="payment-method-option selected" data-payment-method="card">
                                <i class="fas fa-credit-card"></i>
                                <span>Credit/Debit Card</span>
                            </div>
                            <div class="payment-method-option" data-payment-method="netbanking">
                                <i class="fas fa-university"></i>
                                <span>Net Banking</span>
                            </div>
                            <div class="payment-method-option" data-payment-method="upi">
                                <i class="fas fa-qrcode"></i>
                                <span>UPI / Wallets</span>
                            </div>
                            <div class="payment-method-option" data-payment-method="cod">
                                <i class="fas fa-hand-holding-usd"></i>
                                <span>Cash on Delivery</span>
                            </div>
                        </div>

                        <!-- Card Details Form (Initially hidden) -->
                        <div id="card-details-form">
                            <h3>Enter Card Details</h3>
                            <div class="form-group">
                                <label for="card-number">Card Number</label>
                                <input type="text" id="card-number" name="card-number" placeholder="XXXX XXXX XXXX XXXX" pattern="[0-9]{4}[ ]?[0-9]{4}[ ]?[0-9]{4}[ ]?[0-9]{4}" title="Enter a valid 16-digit card number" required>
                            </div>
                            <div class="inline-fields">
                                <div class="form-group">
                                    <label for="expiry-date">Expiry Date (MM/YY)</label>
                                    <input type="text" id="expiry-date" name="expiry-date" placeholder="MM/YY" pattern="(0[1-9]|1[0-2])\/?([0-9]{2})" title="Enter expiry date in MM/YY format" required>
                                </div>
                                <div class="form-group">
                                    <label for="cvv">CVV</label>
                                    <input type="password" id="cvv" name="cvv" placeholder="XXX" pattern="[0-9]{3,4}" title="Enter 3 or 4 digit CVV" required>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="card-name">Name on Card</label>
                                <input type="text" id="card-name" name="card-name" placeholder="Name as it appears on card" required>
                            </div>
                            <div class="form-group">
                                <input type="checkbox" id="save-card" name="save-card">
                                <label for="save-card">Save this card for future orders</label>
                            </div>
                        </div>

                        <!-- Saved Cards (if logged in, hidden if card details form is active) -->
                        <div id="saved-cards" style="display: block;">
                            <h3>Or Use Saved Card</h3>
                            <div class="saved-card-option selected" data-card-id="visa-1234">
                                <input type="radio" name="payment-option" value="visa-1234" checked>
                                <div>
                                    <i class="fab fa-cc-visa"></i> Visa **** 1234<br>
                                    <span>Expires 12/25</span>
                                </div>
                            </div>
                            <div class="saved-card-option" data-card-id="mastercard-5678">
                                <input type="radio" name="payment-option" value="mastercard-5678">
                                <div>
                                    <i class="fab fa-cc-mastercard"></i> Mastercard **** 5678<br>
                                    <span>Expires 08/24</span>
                                </div>
                            </div>
                            <button type="button" class="btn primary-btn" style="margin-top: 15px; width: auto;" onclick="toggleNewCardForm()">Add New Card</button>
                        </div>

                    </div>
                    
                    <!-- Place Order Button here, as part of the form -->
                    <button type="submit" class="btn place-order-btn">Place Order</button>
                </form>
            </div>

            <div class="order-summary-sidebar">
                <h3>Your Order Details</h3>
                <div id="checkout-summary-items">
                    <!-- Cart items will be dynamically loaded here by JS -->
                    <!-- Example:
                    <div class="summary-item">
                        <img src="https://via.placeholder.com/60x60?text=Pizza" alt="Margherita Pizza" class="summary-item-image">
                        <div class="summary-item-details">
                            <h4>Margherita Pizza x 1</h4>
                            <p>from Luigi's Pizzeria</p>
                        </div>
                        <span class="summary-item-price">₹450.00</span>
                    </div>
                    -->
                </div>

                <div class="summary-row">
                    <span>Subtotal</span>
                    <span id="summary-subtotal">₹0.00</span>
                </div>
                <div class="summary-row">
                    <span>Delivery Fee</span>
                    <span id="summary-delivery-fee">₹50.00</span>
                </div>
                <div class="summary-row">
                    <span>Service Charge</span>
                    <span id="summary-service-charge">₹10.00</span>
                </div>
                <div class="summary-row">
                    <span>GST (5%)</span>
                    <span id="summary-gst">₹0.00</span>
                </div>
                <div class="summary-total">
                    <span>Total</span>
                    <span id="summary-total">₹0.00</span>
                </div>
                
                <a href="cart.html" style="display: block; text-align: center; margin-top: 20px; color: var(--text-color); font-size: 0.95rem;">
                    <i class="fas fa-edit"></i> Edit Cart
                </a>
            </div>
        </section>
    </main>

    <footer>
        <div class="container footer-content">
            <div class="footer-logo">QuickBite</div>
            <div class="footer-links">
                <h3>Quick Links</h3>
                <ul>
                    <li><a href="#">About Us</a></li>
                    <li><a href="#">Careers</a></li>
                    <li><a href="#">Blog</a></li>
                    <li><a href="#">Press</a></li>
                </ul>
            </div>
            <div class="footer-customer-service">
                <h3>Customer Service</h3>
                <ul>
                    <li><a href="#">Help & FAQs</a></li>
                    <li><a href="#">Contact Us</a></li>
                    <li><a href="#">Privacy Policy</a></li>
                    <li><a href="#">Terms of Service</a></li>
                </ul>
            </div>
            <div class="footer-social-apps">
                <h3>Follow Us</h3>
                <div class="social-icons">
                    <a href="#"><i class="fab fa-facebook-f"></i></a>
                    <a href="#"><i class="fab fa-twitter"></i></a>
                    <a href="#"><i class="fab fa-instagram"></i></a>
                </div>
                <h3>Get the App</h3>
                <div class="app-links">
                    <a href="#"><img src="https://via.placeholder.com/120x40?text=App+Store" alt="App Store"></a>
                    <a href="#"><img src="https://via.placeholder.com/120x40?text=Google+Play" alt="Google Play"></a>
                </div>
            </div>
        </div>
        <div class="footer-bottom">
            <div class="container">
                &copy; 2023 QuickBite. All rights reserved.
            </div>
        </div>
    </footer>

    <script src="script.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const checkoutSummaryItems = document.getElementById('checkout-summary-items');
            const summarySubtotal = document.getElementById('summary-subtotal');
            const summaryDeliveryFee = document.getElementById('summary-delivery-fee');
            const summaryServiceCharge = document.getElementById('summary-service-charge');
            const summaryGST = document.getElementById('summary-gst');
            const summaryTotal = document.getElementById('summary-total');
            const cartCountElement = document.querySelector('.cart-count');
            const placeOrderBtn = document.querySelector('.place-order-btn');

            const savedAddressCards = document.querySelectorAll('.saved-address-card');
            const paymentMethodOptions = document.querySelectorAll('.payment-method-option');
            const cardDetailsForm = document.getElementById('card-details-form');
            const savedCardsSection = document.getElementById('saved-cards');
            const savedCardOptions = document.querySelectorAll('.saved-card-option');
            
            const DELIVERY_FEE = 50; // Example fixed delivery fee in INR
            const SERVICE_CHARGE = 10; // Example fixed service charge in INR
            const GST_RATE = 0.05; // 5% GST

            let cart = JSON.parse(localStorage.getItem('quickbiteCart')) || [];

            function updateCartCount() {
                cartCountElement.textContent = cart.reduce((total, item) => total + item.quantity, 0);
            }

            function calculateSummary() {
                let subtotal = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
                let gstAmount = (subtotal + DELIVERY_FEE + SERVICE_CHARGE) * GST_RATE;
                let total = subtotal + DELIVERY_FEE + SERVICE_CHARGE + gstAmount;

                summarySubtotal.textContent = `₹${subtotal.toFixed(2)}`;
                summaryDeliveryFee.textContent = `₹${DELIVERY_FEE.toFixed(2)}`;
                summaryServiceCharge.textContent = `₹${SERVICE_CHARGE.toFixed(2)}`;
                summaryGST.textContent = `₹${gstAmount.toFixed(2)}`;
                summaryTotal.textContent = `₹${total.toFixed(2)}`;

                // Disable place order button if cart is empty
                if (cart.length === 0) {
                    placeOrderBtn.classList.add('disabled');
                    placeOrderBtn.setAttribute('disabled', 'true');
                    placeOrderBtn.textContent = 'Cart is Empty';
                } else {
                    placeOrderBtn.classList.remove('disabled');
                    placeOrderBtn.removeAttribute('disabled');
                    placeOrderBtn.textContent = 'Place Order';
                }
            }

            function renderOrderSummaryItems() {
                checkoutSummaryItems.innerHTML = ''; // Clear previous items
                if (cart.length === 0) {
                    checkoutSummaryItems.innerHTML = '<p>Your cart is empty. Please add items from the <a href="restaurants.html">restaurants page</a>.</p>';
                    return;
                }

                cart.forEach(item => {
                    const itemElement = document.createElement('div');
                    itemElement.classList.add('summary-item');
                    itemElement.innerHTML = `
                        <img src="${item.image || 'https://via.placeholder.com/60x60?text=Food'}" alt="${item.name}" class="summary-item-image">
                        <div class="summary-item-details">
                            <h4>${item.name} x ${item.quantity}</h4>
                            <p>${item.restaurantName ? `from ${item.restaurantName}` : ''}</p>
                        </div>
                        <span class="summary-item-price">₹${(item.price * item.quantity).toFixed(2)}</span>
                    `;
                    checkoutSummaryItems.appendChild(itemElement);
                });
            }

            // Address selection logic
            savedAddressCards.forEach(card => {
                card.addEventListener('click', () => {
                    savedAddressCards.forEach(c => c.classList.remove('selected'));
                    card.classList.add('selected');
                    card.querySelector('input[type="radio"]').checked = true;
                    // In a real app, update form fields based on selected address
                });
            });

            // Payment method selection logic
            paymentMethodOptions.forEach(option => {
                option.addEventListener('click', () => {
                    paymentMethodOptions.forEach(o => o.classList.remove('selected'));
                    option.classList.add('selected');
                    const selectedMethod = option.dataset.paymentMethod;

                    // Show/hide card details form based on selection
                    if (selectedMethod === 'card') {
                        cardDetailsForm.style.display = 'block';
                        savedCardsSection.style.display = 'block'; // Show saved cards if available
                        // Ensure card number, expiry, CVV fields are required if card is selected
                        document.getElementById('card-number').setAttribute('required', 'true');
                        document.getElementById('expiry-date').setAttribute('required', 'true');
                        document.getElementById('cvv').setAttribute('required', 'true');
                    } else {
                        cardDetailsForm.style.display = 'none';
                        savedCardsSection.style.display = 'none';
                        // Remove required attribute if not card payment
                        document.getElementById('card-number').removeAttribute('required');
                        document.getElementById('expiry-date').removeAttribute('required');
                        document.getElementById('cvv').removeAttribute('required');
                    }
                    // For other methods (Net Banking, UPI, COD), you might show specific instructions or fields.
                });
            });

            // Saved card selection logic (only applies if Card method is chosen)
            savedCardOptions.forEach(card => {
                card.addEventListener('click', () => {
                    savedCardOptions.forEach(c => c.classList.remove('selected'));
                    card.classList.add('selected');
                    card.querySelector('input[type="radio"]').checked = true;
                    // If a saved card is selected, hide new card form and mark card details as optional
                    cardDetailsForm.style.display = 'none';
                    document.getElementById('card-number').removeAttribute('required');
                    document.getElementById('expiry-date').removeAttribute('required');
                    document.getElementById('cvv').removeAttribute('required');
                });
            });

            // Function to toggle between new card form and saved cards
            window.toggleNewCardForm = function() {
                if (cardDetailsForm.style.display === 'block') {
                    cardDetailsForm.style.display = 'none';
                    savedCardsSection.style.display = 'block';
                    // Re-add required for saved card radios if new card form is hidden
                    savedCardOptions.forEach(opt => opt.querySelector('input').setAttribute('required', 'true'));
                    document.getElementById('card-number').removeAttribute('required');
                    document.getElementById('expiry-date').removeAttribute('required');
                    document.getElementById('cvv').removeAttribute('required');
                } else {
                    cardDetailsForm.style.display = 'block';
                    savedCardsSection.style.display = 'none';
                     // Remove required from saved card radios if new card form is shown
                    savedCardOptions.forEach(opt => opt.querySelector('input').removeAttribute('required'));
                    document.getElementById('card-number').setAttribute('required', 'true');
                    document.getElementById('expiry-date').setAttribute('required', 'true');
                    document.getElementById('cvv').setAttribute('required', 'true');
                }
            };


            // Handle form submission
            document.getElementById('checkout-form').addEventListener('submit', (e) => {
                e.preventDefault(); // Prevent default form submission

                if (cart.length === 0) {
                    alert('Your cart is empty. Please add items before placing an order.');
                    return;
                }

                // Gather form data (conceptual)
                const formData = new FormData(e.target);
                const orderData = Object.fromEntries(formData.entries());
                orderData.cartItems = cart; // Attach actual cart items

                console.log('Order Data:', orderData);
                alert('Order Placed Successfully! (Conceptual)');

                // In a real application:
                // 1. Send orderData to your backend API.
                // 2. Handle payment processing (redirect to payment gateway, or process directly).
                // 3. Clear the cart (localStorage.removeItem('quickbiteCart')).
                // 4. Redirect to an order tracking or confirmation page.
                localStorage.removeItem('quickbiteCart'); // Clear cart after "placing" order
                window.location.href = 'track-order.html'; // Redirect to tracking page
            });

            // Initial renders
            renderOrderSummaryItems();
            calculateSummary();
            updateCartCount();

            // Set initial state for card details form (hidden by default unless explicitly chosen)
            if (document.querySelector('.payment-method-option.selected')?.dataset.paymentMethod !== 'card') {
                cardDetailsForm.style.display = 'none';
                // Also ensure saved card inputs are not required initially if another payment method is selected
                savedCardOptions.forEach(opt => opt.querySelector('input').removeAttribute('required'));
            } else {
                 // If card is initially selected, ensure new card fields are required by default
                document.getElementById('card-number').setAttribute('required', 'true');
                document.getElementById('expiry-date').setAttribute('required', 'true');
                document.getElementById('cvv').setAttribute('required', 'true');
            }
        });
    </script>
</body>
</html>